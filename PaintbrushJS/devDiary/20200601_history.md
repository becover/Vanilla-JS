# 2020ë…„ 6ì›” 1ì¼ ê°œë°œì¼ê¸°

### undo, redo ì‰½ê²Œ ìƒê°í–ˆë”ë‹ˆ..

```javascript
/**
 * mouseup
 */
canvasHistory.redoList.length > 0 &&
  canvasHistory.undoList.push(canvasHistory.redoList.pop());
stackCanvasHistory();
canvasHistory.redoList = [];

/**
 * history buttons
 */

function bindDrawImage(beforeList, afterList) {
  const LastHistoryIndex = beforeList.pop();
  afterList.push(LastHistoryIndex);
  const img = new Image();
  const src = LastHistoryIndex;
  img.src = src;
  img.onload = function () {
    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
  };
}

function handleRedoHistory() {
  if (canvasHistory.redoList.length <= 0) return false;
  bindDrawImage(canvasHistory.redoList, canvasHistory.undoList);
}

function handleUndoHistory() {
  if (canvasHistory.redoList.length < 1) {
    const lastImg = canvasHistory.undoList.pop();
    canvasHistory.redoList.push(lastImg);
  }
  if (canvasHistory.undoList.length <= 0) {
    ctx.fillStyle = "#fff";
    ctx.clearRect(0, 0, canvasStatus.width, canvasStatus.height);
    return false;
  }
  bindDrawImage(canvasHistory.undoList, canvasHistory.redoList);
}

undoButton.addEventListener("click", handleUndoHistory);
redoButton.addEventListener("click", handleRedoHistory);
```

ê¸°ì¡´ ì½”ë“œì—ì„œ ì´ë ‡ê²Œ ê³ ì³ë„ ìžê¾¸ë§Œ í…ŒìŠ¤íŠ¸ì‹œ ì˜ë„ì¹˜ ì•Šì€ ëª¨ìŠµì´ ë°œìƒí•´ì„œ ê³„ì† ê³ ë¯¼í•˜ë©° ìˆ˜ì •í•œ ê²°ê³¼.  
ì–´ë””ê°€ ìž˜ ëª» ëœê±´ì§€ ì°¾ì•„ ëƒˆë‹¤. undoëŠ” ì²˜ìŒ ëˆ„ë¥¼ë•Œ ìµœê·¼ img urlì„ ë°”ë¡œ redoì—ê²Œ ë³´ë‚´ê³  ì´ì „ê»„ popí•´ì„œ í™”ë©´ì— ë¿Œë ¤ì£¼ë©° redoì— pushí•˜ì§€ë§Œ, ë°˜ëŒ€ë¡œ redoì—ì„  ê·¸ëŸ°ê²Œ ì—†ê¸° ë•Œë¬¸ì— ì²˜ìŒ redoëˆ„ë¥¼ë• ë‘ë²ˆì„ ëˆŒëŸ¬ì•¼ë§Œ ìž‘ë™ ë˜ëŠ”ê²ƒ ì²˜ëŸ¼ ë³´ì—¬ì§„ê²Œ ëœë‹¤.  
ë°©ê¸ˆ ë³´ë‚¸ê±¸ ë‹¤ì‹œ ë¿Œë ¤ì£¼ë‹ˆ ë§ˆì¹˜ ìž‘ë™ ì•ŠëŠ” ê²ƒ ì²˜ëŸ¼ ë³´ì—¬ì§€ëŠ” ê²ƒì´ë‹¤.  
ê·¸ëž˜ì„œ ë°”ê¾¸ê¸°ë¡œ í–ˆë‹¤.

```javascript
/**
 * mouseup
 */
stackCanvasHistory();
canvasHistory.redoList = [];

/**
 * history buttons
 */
function move2history(to, from) {
  const lastImg = to.pop();
  from.push(lastImg);
}

function drawingImage2canvas(list) {
  const img = new Image();
  const src = list[list.length - 1];
  img.src = src;
  img.onload = function () {
    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
  };
}

function handleRedoHistory() {
  const { undoList, redoList } = canvasHistory;

  if (redoList.length <= 0) return false;

  move2history(redoList, undoList);
  drawingImage2canvas(undoList);
}

function handleUndoHistory() {
  const { undoList, redoList } = canvasHistory;

  if (undoList.length <= 0) {
    ctx.clearRect(0, 0, canvasStatus.width, canvasStatus.height);
    return false;
  } else if (undoList.length === 1) {
    move2history(undoList, redoList);
    ctx.clearRect(0, 0, canvasStatus.width, canvasStatus.height);
    return false;
  }
  move2history(undoList, redoList);
  drawingImage2canvas(undoList);
}

undoButton.addEventListener("click", handleUndoHistory);
redoButton.addEventListener("click", handleRedoHistory);
```

í•´ë‹¹ ì½”ë“œë¥¼ ë³´ë©´ popí•´ì„œ ì„œë¡œì—ê²Œ ë„˜ê²¨ì£¼ëŠ”ê±´ ê°™ìœ¼ë‚˜ ë§ˆì§€ë§‰ ì¸ë±ìŠ¤ì— ìžˆëŠ”ê±¸ ë³´ì—¬ì£¼ê¸°ë§Œ í• ë¿ì´ë‹¤. ì´ë¡œ ì¸í•´ì„œ mouseupì¼ë•Œ redoê°€ ë¹ˆë¹„ì—´ì´ ì•„ë‹ì‹œ undoì—ê²Œ popí•´ì„œ ë„˜ê²¨ì£¼ëŠ” ìž‘ì—…ì„ í•  í•„ìš”ê°€ ì—†ì–´ì¡Œë‹¤.  
ë” ì½”ë“œê°€ ê¹”ë”í•´ì§„ ê²ƒì„ ì•Œ ìˆ˜ ìžˆë‹¤.  
í…ŒìŠ¤íŠ¸ í•´ë³´ë‹ˆ ìž˜ ìž‘ë™ ëœë‹¤ðŸ¤­ðŸ¤­
